// Copyright 2023 quocdang1998
#include "merlin/candy/loss.hpp"

namespace merlin {

// ---------------------------------------------------------------------------------------------------------------------
// RMSE
// ---------------------------------------------------------------------------------------------------------------------

__cuhostdev__ double candy::rmse_averager(const double * thread_result_data,
                                          const std::uint64_t * non_zero_element_data, std::uint64_t n_threads) {
    double result = 0.0;
    std::uint64_t non_zero = 0;
    for (std::uint64_t i = 0; i < n_threads; i++) {
        result += thread_result_data[i];
        non_zero += non_zero_element_data[i];
    }
    return result / non_zero;
}

// ---------------------------------------------------------------------------------------------------------------------
// RMAE
// ---------------------------------------------------------------------------------------------------------------------

__cuhostdev__ double candy::rmae_averager(const double * thread_result_data,
                                          const std::uint64_t * non_zero_element_data, std::uint64_t n_threads) {
    double result = 0.0;
    for (std::uint64_t i = 0; i < n_threads; i++) {
        result = (thread_result_data[i] > result) ? thread_result_data[i] : result;
    }
    return result;
}

}  // namespace merlin
